<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetGuard æ™ºèƒ½ç›‘æ§ Demo</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.344.0"
      }
    }
    </script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Camera, Activity, Bell, Settings, Play, Pause, AlertTriangle, Clock, X, 
            Sparkles, Utensils, Moon, Footprints, Upload, Volume2, VolumeX, Eye, 
            Radio, MessageCircle, Send, User, Bot, Filter, ZoomIn, PlayCircle, Film, 
            Loader2, Wifi, Battery, ChevronRight, Edit2, Shield, Droplets, Calendar, 
            BarChart2, ChevronLeft, Minimize2
        } from 'lucide-react';

        const apiKey = ""; 

        // === å‰§æœ¬é…ç½® ===
        const VIDEO_SCRIPT = [
          { startTime: 0, endTime: 8, hasMotion: false, cameraStatus: { text: 'ç›‘æ§ä¸­', color: 'bg-green-500' }, boxes: [] },
          { startTime: 8, endTime: 12, hasMotion: true, cameraStatus: { text: 'è¯†åˆ«ä¸­', color: 'bg-blue-500' }, boxes: [] },
          { 
            startTime: 12, endTime: 16, hasMotion: true, cameraStatus: { text: 'âš ï¸ å¼‚å¸¸', color: 'bg-orange-500' }, 
            triggerAlert: { 
              timeTrigger: 14, cat: 'åŒçŒ«', type: 'warning', action: 'æ·±å¤œè·‘é…·', title: 'æ£€æµ‹åˆ°æ·±å¤œè·‘é…·è¡Œä¸º', 
              detail: 'ã€å¤œè§†è¡Œä¸ºåˆ†æã€‘ç›‘æµ‹åˆ°å®¢å…å‘ç”Ÿæ¿€çƒˆçš„è¿½é€æ¸¸æˆã€‚æ —å­ç‡å…ˆå‘èµ·å†²åˆºï¼Œå¥¶æ²¹ç´§éšå…¶åã€‚åŒæ–¹åŠ¨ä½œæ•æ·ï¼ŒAI åˆ¤å®šä¸ºé«˜èƒ½ç©è€çŠ¶æ€ã€‚', videoTime: 14 
            },
            boxes: []
          },
          { startTime: 16, endTime: 100, hasMotion: false, cameraStatus: { text: 'ç›‘æ§ä¸­', color: 'bg-green-500' }, boxes: [] }
        ];

        const initialLogs = [
          { id: 10, time: '10:45', cat: 'åŒçŒ«', type: 'normal', action: 'è¿½é€æ‰“é—¹', detail: 'å®¢å…å‘ç”ŸçŸ­æ—¶è¿½é€ï¼Œæ´»è·ƒåº¦ä¸Šå‡ï¼Œæœªæ£€æµ‹åˆ°æ”»å‡»è¡Œä¸º', videoTime: null, thumbColor: 'bg-indigo-100' },
          { id: 9, time: '10:20', cat: 'æ —å­', type: 'normal', action: 'ç©è€', detail: 'ç‹¬è‡ªç©çŒ«è–„è·çƒï¼ŒæŒç»­ 5 åˆ†é’Ÿ', videoTime: null, thumbColor: 'bg-orange-100' },
          { id: 8, time: '09:40', cat: 'å¥¶æ²¹', type: 'normal', action: 'é¥®æ°´', detail: 'é¥®æ°´é‡çº¦ 45mlï¼Œé¥®æ°´æœºå·¥ä½œæ­£å¸¸', videoTime: null, thumbColor: 'bg-blue-50' },
          { id: 7, time: '08:15', cat: 'åŒçŒ«', type: 'normal', action: 'è¿›é£Ÿ', detail: 'è‡ªåŠ¨å–‚é£Ÿå™¨å‡ºç²®ï¼ŒåŒçŒ«åŒæ—¶è¿›é£Ÿæ—©é¤', videoTime: null, thumbColor: 'bg-green-100' }, 
          { id: 6, time: '06:30', cat: 'æ —å­', type: 'normal', action: 'è·‘é…·', detail: 'æ£€æµ‹åˆ°é«˜é¢‘ç§»åŠ¨ï¼Œç–‘ä¼¼æ—©é—´å”¤é†’æœåŠ¡', videoTime: null, thumbColor: 'bg-red-50' },
        ];

        const getHistoryLogs = (date) => {
          if (date.includes('24')) return initialLogs; 
          const events = [
            { cat: 'æ —å­', action: 'æ´»åŠ¨', detail: 'å‡Œæ™¨ä¸‰ç‚¹çš„é«˜é€Ÿè¿åŠ¨', thumbColor: 'bg-orange-100' },
            { cat: 'å¥¶æ²¹', action: 'ä¼‘æ¯', detail: 'åœ¨æ²™å‘ä¸Šç¡äº†æ•´æ•´ä¸€ä¸‹åˆ', thumbColor: 'bg-yellow-50' },
            { cat: 'åŒçŒ«', action: 'è¿›é£Ÿ', detail: 'æ­£å¸¸çš„æ™šé¤æ—¶é—´', thumbColor: 'bg-green-50' },
            { cat: 'æ —å­', action: 'æ´»åŠ¨', detail: 'ç©çŒ«æŠ“æ¿ç£¨çˆªå­', thumbColor: 'bg-gray-100' },
            { cat: 'åŒçŒ«', action: 'ä¼‘æ¯', detail: 'ä¸¤åªçŒ«ç«™åœ¨çª—å°ä¼‘æ¯ï¼Œçœ‹çª—å¤–', thumbColor: 'bg-blue-50' },
            { cat: 'å¥¶æ²¹', action: 'å‘•å', detail: 'è¯†åˆ«åˆ°ç–‘ä¼¼å‘•åè¡Œä¸ºï¼Œè¯·æ³¨æ„', type: 'danger', videoTime: 10, thumbColor: 'bg-red-100' }, 
          ];
          const count = 3 + Math.floor(Math.random() * 3);
          return Array.from({ length: count }).map((_, i) => {
            const evt = events[Math.floor(Math.random() * events.length)];
            return {
              id: `${date}-${i}`, time: `${10 + i}:30`, cat: evt.cat, type: evt.type || 'normal', action: evt.action, detail: evt.detail, videoTime: evt.videoTime || null, thumbColor: evt.thumbColor
            };
          });
        };

        const initialChat = [
          { id: 1, type: 'bot', text: 'ä½ å¥½ï¼æˆ‘æ˜¯ PetGuard æ™ºèƒ½åŠ©æ‰‹ã€‚å¤œé—´ç›‘æ§æ¨¡å¼å·²å¯åŠ¨ï¼Œæ­£åœ¨å®ˆæŠ¤æ¯›å­©å­ä»¬çš„ç¡çœ ï¼ˆæˆ–è€…è·‘é…·ï¼‰ã€‚', time: '23:00' },
        ];

        const weeklyStats = [
          { date: '11/18', day: 'ä¸€', liziActive: 60, liziEat: 4, creamActive: 20, creamEat: 3 },
          { date: '11/19', day: 'äºŒ', liziActive: 75, liziEat: 5, creamActive: 25, creamEat: 3 },
          { date: '11/20', day: 'ä¸‰', liziActive: 50, liziEat: 3, creamActive: 15, creamEat: 2 },
          { date: '11/21', day: 'å››', liziActive: 80, liziEat: 5, creamActive: 30, creamEat: 4 },
          { date: '11/22', day: 'äº”', liziActive: 65, liziEat: 4, creamActive: 22, creamEat: 3 },
          { date: '11/23', day: 'å…­', liziActive: 90, liziEat: 6, creamActive: 35, creamEat: 4 },
          { date: '11/24', day: 'æ—¥', liziActive: 92, liziEat: 4, creamActive: 28, creamEat: 3 }, 
        ];

        const generateCalendarDays = () => {
          const days = [];
          for (let i = 0; i < 6; i++) days.push(null);
          for (let i = 1; i <= 30; i++) days.push(i);
          return days;
        };

        function App() {
          const [activeTab, setActiveTab] = useState('home');
          const [logs, setLogs] = useState(initialLogs);
          const [chatMessages, setChatMessages] = useState(initialChat);
          const [videoUrl, setVideoUrl] = useState(null);
          const [viewMode, setViewMode] = useState('live');
          const [selectedCatFilter, setSelectedCatFilter] = useState('all'); 
          const [recordCatFilter, setRecordCatFilter] = useState('all');
          const [playModal, setPlayModal] = useState({ show: false, startTime: 0 }); 
          const [isAiThinking, setIsAiThinking] = useState(false);
          const [selectedDate, setSelectedDate] = useState('11/24'); 
          const [recordLogs, setRecordLogs] = useState(initialLogs); 
          const [showCalendarModal, setShowCalendarModal] = useState(false); 
          const [motionDetected, setMotionDetected] = useState(false);
          const [cameraLabel, setCameraLabel] = useState({ text: 'ç­‰å¾…è§†é¢‘æº...', color: 'bg-gray-400' });
          const [inputMessage, setInputMessage] = useState('');
          const [pushNotification, setPushNotification] = useState(null);
          
          const [triggeredAlerts, setTriggeredAlerts] = useState(new Set());

          const videoRef = useRef(null);
          const modalVideoRef = useRef(null);
          const [isPlaying, setIsPlaying] = useState(false);
          const [isMuted, setIsMuted] = useState(true);
          const [currentTime, setCurrentTime] = useState(0);
          const chatContainerRef = useRef(null);

          const catStats = {
            'æ —å­': { 
              activeLevel: 92, eatCount: 2, drinkCount: 2, avatarColor: 'bg-gray-200', type: 'ç‹¸èŠ±çŒ«', weight: '4.2kg',
              report: `**ã€æ —å­æ—¥æŠ¥ã€‘**\nä»Šæ—¥æ ‡ç­¾ï¼š**ç²¾åŠ›è¿‡å‰©**ã€‚\n6ç‚¹åŠå°±å¼€å§‹**è·‘é…·**ï¼Œ10ç‚¹åˆç©äº†çŒ«è–„è·çƒã€‚08:15 åƒäº†æ—©é¤ã€‚æˆªæ­¢ç›®å‰æ´»è·ƒåº¦å…¨å®¶ç¬¬ä¸€ã€‚æ³¨æ„ï¼š23:09 æ£€æµ‹åˆ°**å¤œé—´è·‘é…·**ã€‚`
            },
            'å¥¶æ²¹': { 
              activeLevel: 28, eatCount: 1, drinkCount: 1, avatarColor: 'bg-yellow-100', type: 'é‡‘æ¸å±‚é•¿æ¯›', weight: '5.5kg',
              report: `**ã€å¥¶æ²¹æ—¥æŠ¥ã€‘**\nä»Šæ—¥æ ‡ç­¾ï¼š**å²æœˆé™å¥½**ã€‚\né™¤äº†æ—©ä¸Šåƒé¥­å’Œ **09:40 å–æ°´**ï¼Œå‡ ä¹éƒ½åœ¨ç¡è§‰æˆ–æš—ä¸­è§‚å¯Ÿã€‚10:45 è¢«æ —å­å¸¦ç€è·‘äº†ä¸¤æ­¥ï¼Œæ€»ä½“éå¸¸è®©äººçœå¿ƒã€‚`
            }
          };

          const handleFileUpload = (event) => {
            const file = event.target.files[0];
            if (file) {
              const url = URL.createObjectURL(file);
              setVideoUrl(url);
              setViewMode('live');
              setTriggeredAlerts(new Set()); 
              setTimeout(() => {
                if(videoRef.current) {
                    videoRef.current.play();
                    setIsPlaying(true);
                }
              }, 500);
            }
          };

          useEffect(() => {
            setRecordLogs(getHistoryLogs(selectedDate));
          }, [selectedDate]);

          useEffect(() => {
            if (chatContainerRef.current) {
              chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;
            }
          }, [chatMessages, activeTab]);

          const callGeminiAI = async (userQuery, currentLogs) => {
            const systemPrompt = `ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½å® ç‰©ç›‘æ§åŠ©æ‰‹ PetGuardã€‚è¯·æ ¹æ®ä»¥ä¸‹ä»Šæ—¥å®æ—¶æ•°æ®å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
            ã€å®¶åº­æ¡£æ¡ˆã€‘
            æ—¥æœŸï¼š2025å¹´11æœˆ24æ—¥
            1. æ —å­ï¼ˆç‹¸èŠ±çŒ«ï¼‰ï¼šæ´»è·ƒåº¦ ${catStats['æ —å­'].activeLevel}% (é«˜)ï¼Œè¿›é£Ÿ ${catStats['æ —å­'].eatCount}æ¬¡ã€‚
            2. å¥¶æ²¹ï¼ˆç™½è‰²ç”°å›­çŒ«ï¼‰ï¼šæ´»è·ƒåº¦ ${catStats['å¥¶æ²¹'].activeLevel}% (ä½)ï¼Œè¿›é£Ÿ ${catStats['å¥¶æ²¹'].eatCount}æ¬¡ã€‚
            ã€ä»Šæ—¥å…³é”®æ—¥å¿— (å€’åº)ã€‘
            ${currentLogs.map(l => `- ${l.time} [${l.cat}] ${l.action}: ${l.detail}`).join('\n')}
            ã€å›ç­”è¦æ±‚ã€‘
            1. å¿…é¡»åŸºäºæ—¥å¿—äº‹å®å›ç­”ã€‚
            2. æ —å­ä¸»è¦äº‹ä»¶ï¼š06:30è·‘é…·ï¼Œ08:15åƒé¥­ï¼Œ10:20ç©è€ï¼Œ23:09æ·±å¤œè·‘é…·ã€‚
            3. å¥¶æ²¹ä¸»è¦äº‹ä»¶ï¼š08:15åƒé¥­ï¼Œ09:40å–æ°´ï¼Œ23:09å‚ä¸è·‘é…·ã€‚
            4. é‡ç‚¹ä¿¡æ¯ç”¨ **åŠ ç²—**ã€‚
            5. ç®€ç»ƒäº²åˆ‡ã€‚
            `;

            const getFallbackResponse = () => {
               const q = userQuery.toLowerCase();
               if (q.includes("è¡¨ç°") || q.includes("æ€»ç»“")) return `ä»Šæ—¥æ€»ç»“ï¼š\n1. **æ —å­**ï¼šç²¾åŠ›æ—ºç››ï¼Œæ—©ä¸Šæ™¨ç»ƒï¼Œæ™šä¸Š**23:09**è¿˜æ¥äº†ä¸€åœºæ·±å¤œè·‘é…·ï¼\n2. **å¥¶æ²¹**ï¼šç™½å¤©å¾ˆå®‰é™ï¼Œæ™šä¸Šè¢«æ —å­å¸¦ç€è·‘äº†ä¸€ä¼šå„¿ã€‚\nä¸¤åªçŒ«ä»Šå¤©è¿åŠ¨é‡éƒ½å¾ˆè¶³ã€‚`;
               if (q.includes("æ —å­")) return `**æ —å­**ä»Šå¤©è¿›é£Ÿäº† ${catStats['æ —å­'].eatCount} æ¬¡ã€‚å®ƒéå¸¸æ´»è·ƒï¼Œé™¤äº†æ—©ä¸Šçš„æ™¨ç»ƒï¼Œåˆšåˆš **23:09** è¿˜åœ¨å®¢å…è·‘é…·å‘¢ã€‚`;
               if (q.includes("å¥¶æ²¹")) return `**å¥¶æ²¹**ä»Šå¤©å¾ˆè®©äººçœå¿ƒã€‚è¿›é£Ÿ ${catStats['å¥¶æ²¹'].eatCount} æ¬¡ï¼Œæ´»è·ƒåº¦åªæœ‰ ${catStats['å¥¶æ²¹'].activeLevel}%ã€‚`;
               if (q.includes("å¼‚å¸¸") || q.includes("è¿è§„") || q.includes("è·‘é…·")) return `æ£€æµ‹åˆ°é«˜èƒ½æ—¶åˆ»ï¼š**23:09** æ —å­å’Œå¥¶æ²¹åœ¨å®¢å…è¿›è¡Œäº†æ¿€çƒˆçš„**æ·±å¤œè·‘é…·**ï¼ˆå·²ä¸ºæ‚¨ç”Ÿæˆæ™ºèƒ½å¡ç‰‡ï¼‰ã€‚`;
               return "æˆ‘æ˜¯ PetGuard å® ç‰©çœ‹é¡¾ã€‚æ —å­ä»Šå¤©å¾ˆçš®ï¼Œå¥¶æ²¹å¾ˆä¹–ã€‚æ‚¨å¯ä»¥é—®æˆ‘â€œæ —å­ä»Šå¤©å¹²äº†ä»€ä¹ˆï¼Ÿâ€æˆ–è€…â€œè°åœ¨è·‘é…·ï¼Ÿâ€";
            };

            if (!apiKey) { await new Promise(r => setTimeout(r, 800)); return getFallbackResponse(); }

            try {
              const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: userQuery }] }], systemInstruction: { parts: [{ text: systemPrompt }] } })
              });
              if (!response.ok) return getFallbackResponse();
              const data = await response.json();
              return data.candidates?.[0]?.content?.parts?.[0]?.text || getFallbackResponse();
            } catch (error) { return getFallbackResponse(); }
          };

          const handleSendMessage = async (text = inputMessage) => {
            if (!text.trim()) return;
            const newUserMsg = { id: Date.now(), type: 'user', text: text, time: 'åˆšåˆš' };
            setChatMessages(prev => [...prev, newUserMsg]);
            setInputMessage('');
            setIsAiThinking(true);
            const aiResponseText = await callGeminiAI(text, logs);
            setIsAiThinking(false);
            setChatMessages(prev => [...prev, { id: Date.now() + 1, type: 'bot', text: aiResponseText, time: 'åˆšåˆš' }]);
          };

          // è§†é¢‘ä¸è„šæœ¬é€»è¾‘
          useEffect(() => {
            if (!videoRef.current) return;
            const videoElement = videoRef.current;

            const handleTimeUpdate = () => {
              const time = videoElement.currentTime;
              setCurrentTime(time);
              
              const activeScript = VIDEO_SCRIPT.find(s => time >= s.startTime && time < s.endTime);

              if (activeScript) {
                // ç›´æ’­æ¨¡å¼ï¼šçº¯å‡€ï¼Œä»…æ£€æµ‹åŠ¨æ€
                setMotionDetected(activeScript.hasMotion || false);
                if (activeScript.hasMotion) {
                    setCameraLabel({ text: 'æ£€æµ‹åˆ°åŠ¨æ€', color: 'bg-blue-500' });
                } else {
                    setCameraLabel({ text: 'ğŸ”´', color: 'bg-green-500' });
                }

                // 14s è§¦å‘æŠ¥è­¦
                if (activeScript.triggerAlert && Math.floor(time) === activeScript.triggerAlert.timeTrigger && !playModal.show) {
                   const alertId = `alert-${Math.floor(time)}`;
                   
                   if (!triggeredAlerts.has(alertId)) {
                       setTriggeredAlerts(prev => new Set(prev).add(alertId));
                       
                       // Push
                       setPushNotification({
                         title: activeScript.triggerAlert.title,
                         text: activeScript.triggerAlert.detail,
                         videoTime: activeScript.triggerAlert.videoTime
                       });
                       setTimeout(() => setPushNotification(null), 6000); 
                       
                       // Log
                       const newLog = {
                         id: Date.now(), time: '23:09', cat: activeScript.triggerAlert.cat, type: 'warning',
                         action: activeScript.triggerAlert.action, detail: activeScript.triggerAlert.detail,
                         videoTime: activeScript.triggerAlert.videoTime, thumbColor: 'bg-gray-800 text-white' 
                       };
                       setLogs(oldLogs => [newLog, ...oldLogs]); 

                       // Chat Card
                       setChatMessages(prev => [...prev, {
                         id: Date.now(), type: 'push', time: '23:09', alertId: alertId,
                         title: activeScript.triggerAlert.title, text: activeScript.triggerAlert.detail,
                         videoTime: activeScript.triggerAlert.videoTime,
                         isHighlightCard: true
                       }]);
                   }
                }
              } 
            };

            videoElement.addEventListener('timeupdate', handleTimeUpdate);
            return () => videoElement.removeEventListener('timeupdate', handleTimeUpdate);
          }, [videoUrl, playModal.show, triggeredAlerts]); 

          useEffect(() => {
            if (playModal.show && modalVideoRef.current && videoUrl) {
              modalVideoRef.current.currentTime = playModal.startTime;
              modalVideoRef.current.play().catch(e => {});
            }
          }, [playModal.show, videoUrl]);

          const togglePlay = () => {
            if (videoRef.current) {
              if (isPlaying) videoRef.current.pause(); else videoRef.current.play();
              setIsPlaying(!isPlaying);
            }
          };

          const handleJumpToVideo = (time) => {
            if (time === null || time === undefined) return;
            if (!videoUrl) return alert("è¯·å…ˆåœ¨ç›‘æ§é¡µä¸Šä¼ è§†é¢‘ï¼");
            setPlayModal({ show: true, startTime: time });
            setPushNotification(null);
          };

          const formatText = (text) => {
            if (!text) return null;
            const parts = text.split(/(\*\*.*?\*\*)/g);
            return parts.map((part, index) => {
              if (part.startsWith('**') && part.endsWith('**')) return <strong key={index} className="font-bold text-indigo-700">{part.slice(2, -2)}</strong>;
              return part;
            });
          };

          const TabButton = ({ id, icon: Icon, label }) => (
            <button onClick={() => setActiveTab(id)} className={`flex flex-col items-center justify-center w-full py-2 transition-colors ${activeTab === id ? 'text-orange-600' : 'text-gray-400'}`}>
              <Icon size={24} className={`mb-1 ${activeTab === id ? 'scale-110' : ''} transition-transform`} />
              <span className="text-[10px] font-medium">{label}</span>
            </button>
          );

          return (
            <div className="bg-gray-50 min-h-screen font-sans text-gray-900 pb-20 relative max-w-md mx-auto shadow-2xl overflow-hidden border-x border-gray-200 flex flex-col">
              {pushNotification && (
                <div onClick={() => handleJumpToVideo(pushNotification.videoTime)} className="fixed top-4 left-4 right-4 bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl z-[60] border-l-4 border-orange-500 p-4 animate-in slide-in-from-top-4 duration-500 cursor-pointer flex items-start gap-3 ring-1 ring-black/5">
                   <div className="bg-orange-100 p-2 rounded-full text-orange-600 flex-shrink-0 mt-0.5"><AlertTriangle size={20} /></div>
                   <div className="flex-1 min-w-0"><div className="flex justify-between items-start"><h4 className="font-bold text-gray-900 text-sm">PetGuard æ™ºèƒ½è­¦æŠ¥</h4><span className="text-[10px] text-gray-400">åˆšåˆš</span></div><p className="font-medium text-gray-800 text-xs mt-1 truncate">{pushNotification.title}</p><p className="text-gray-500 text-[10px] mt-0.5 line-clamp-2">{pushNotification.text}</p></div>
                </div>
              )}
              
              {/* AIå›æ”¾å¼¹çª— - çº¯å‡€ç‰ˆ (æ— æ¡†) */}
              {playModal.show && (
                <div className="fixed inset-0 z-50 bg-black/95 flex flex-col justify-center items-center animate-in fade-in duration-200">
                  <button onClick={() => setPlayModal({ show: false, startTime: 0 })} className="absolute top-4 right-4 text-white p-2 bg-white/10 rounded-full hover:bg-white/20 transition-colors z-50"><X size={24} /></button>
                  <div className="w-full aspect-video bg-black relative">
                    <video ref={modalVideoRef} src={videoUrl} className="w-full h-full object-contain" controls muted={isMuted} />
                    {/* å·²ç§»é™¤è¯†åˆ«æ¡† */}
                  </div>
                  <div className="mt-6 text-white/90 text-sm bg-gray-800/80 px-6 py-2 rounded-full border border-white/10 flex items-center gap-2"><Sparkles size={14} className="text-yellow-400"/> äº‘ç«¯ AI åˆ†æå›æ”¾</div>
                </div>
              )}

              {showCalendarModal && (
                <div className="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center animate-in fade-in duration-300">
                   <div className="bg-white w-full max-w-md rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl animate-in slide-in-from-bottom-10 sm:zoom-in-95 duration-300 relative">
                      <button onClick={() => setShowCalendarModal(false)} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-50"><X size={20}/></button>
                      <div className="flex items-center justify-between mb-6 px-1"><div className="text-xl font-bold text-gray-800">2025å¹´ 11æœˆ</div><div className="flex gap-2"><button className="p-2 hover:bg-gray-100 rounded-full text-gray-400"><ChevronLeft size={20}/></button><button className="p-2 hover:bg-gray-100 rounded-full text-gray-400"><ChevronRight size={20}/></button></div></div>
                      <div className="grid grid-cols-7 gap-y-4 gap-x-2 text-center mb-4">{['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'].map(d => <div key={d} className="text-xs text-gray-400 font-medium">{d}</div>)}{generateCalendarDays().map((day, i) => (<div key={i} className="flex justify-center">{day ? (<button onClick={() => { setSelectedDate(`11/${day}`); setShowCalendarModal(false); }} className={`w-9 h-9 rounded-full flex items-center justify-center text-sm font-medium transition-all ${`11/${day}` === selectedDate ? 'bg-orange-500 text-white shadow-lg shadow-orange-200' : day === 24 ? 'bg-orange-50 text-orange-600 border border-orange-200' : 'hover:bg-gray-100 text-gray-700'}`}>{day}</button>) : <div className="w-9 h-9"></div>}</div>))}</div>
                      <div className="text-center"><button onClick={() => { setSelectedDate('11/24'); setShowCalendarModal(false); }} className="text-sm text-orange-600 font-medium hover:underline">å›åˆ°ä»Šå¤©</button></div>
                   </div>
                </div>
              )}

              <div className={`flex flex-col flex-1 h-full ${activeTab === 'home' ? 'block' : 'hidden'}`}>
                  <div className="relative bg-black w-full aspect-video flex-shrink-0 z-20 shadow-md">
                    {videoUrl ? (
                      <>
                        <video ref={videoRef} src={videoUrl} className="w-full h-full object-contain bg-black" loop muted={isMuted} playsInline onPlay={() => setIsPlaying(true)} onPause={() => setIsPlaying(false)} />
                        
                        {/* çº¯å‡€æ¨¡å¼ï¼šä»…ä¿ç•™åº•éƒ¨æ§åˆ¶ */}
                        <div className="absolute bottom-3 right-3 flex gap-2">
                           <button onClick={() => setIsMuted(!isMuted)} className="p-1.5 bg-black/40 rounded-full text-white/80 backdrop-blur-sm hover:bg-black/60 transition-colors">{isMuted ? <VolumeX size={16}/> : <Volume2 size={16}/>}</button>
                           <button onClick={togglePlay} className="p-1.5 bg-black/40 rounded-full text-white/80 backdrop-blur-sm hover:bg-black/60 transition-colors">{isPlaying ? <Pause size={16}/> : <Play size={16}/>}</button>
                        </div>
                      </>
                    ) : (
                      <div className="absolute inset-0 flex flex-col items-center justify-center text-gray-500 bg-gray-900">
                        <Upload size={32} className="mb-2 opacity-50"/>
                        <label className="text-xs bg-gray-800 text-gray-300 px-4 py-2 rounded-full cursor-pointer hover:bg-gray-700 transition-colors border border-gray-700">ä¸Šä¼ è§†é¢‘æº <input type="file" onChange={handleFileUpload} className="hidden" accept="video/*"/></label>
                      </div>
                    )}
                  </div>
                  <div className="flex-1 flex flex-col bg-gray-50 overflow-hidden relative">
                     <div className="flex-1 overflow-y-auto p-4 space-y-4" ref={chatContainerRef}>
                        <div className="grid grid-cols-2 gap-3 mb-2">{Object.keys(catStats).map(cat => (<div key={cat} className="bg-white p-3 rounded-xl border border-gray-100 shadow-sm flex flex-col gap-2"><div className="flex items-center gap-2"><div className={`w-6 h-6 rounded-full ${catStats[cat].avatarColor} flex items-center justify-center text-[10px] font-bold`}>{cat[0]}</div><span className="font-bold text-xs text-gray-800">{cat}</span></div><div><div className="flex justify-between text-[10px] text-gray-400 mb-1"><span>æ´»è·ƒåº¦</span><span className="font-bold text-gray-600">{catStats[cat].activeLevel}%</span></div><div className="w-full bg-gray-100 h-1 rounded-full overflow-hidden"><div className={`h-full rounded-full ${cat === 'æ —å­' ? 'bg-orange-400' : 'bg-yellow-400'}`} style={{ width: `${catStats[cat].activeLevel}%` }}></div></div></div><div className="flex items-center justify-between bg-gray-50 px-2 py-1 rounded text-[10px] text-gray-500"><div className="flex items-center gap-1"><Utensils size={10}/> {catStats[cat].eatCount}</div><div className="flex items-center gap-1"><Droplets size={10}/> {catStats[cat].drinkCount}</div></div></div>))}</div>
                        {chatMessages.map(msg => (
                          <div key={msg.id} className={`flex flex-col animate-in slide-in-from-bottom-2 fade-in duration-300 ${msg.type === 'user' ? 'items-end' : 'items-start'}`}>
                             <div className={`flex max-w-[90%] ${msg.type === 'user' ? 'flex-row-reverse' : 'flex-row'} items-end gap-2`}>
                                {msg.type !== 'user' && <div className={`w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center shadow-sm ${msg.type === 'push' ? 'bg-orange-100 text-orange-600' : 'bg-white text-indigo-600 border border-gray-100'}`}>{msg.type === 'push' ? <AlertTriangle size={16}/> : <Bot size={18}/>}</div>}
                                <div className={`relative px-4 py-3 text-sm shadow-sm ${msg.type === 'user' ? 'bg-indigo-600 text-white rounded-2xl rounded-br-sm' : msg.isHighlightCard ? 'w-full p-0 bg-transparent shadow-none' : msg.type === 'push' ? 'bg-white border-l-4 border-orange-500 rounded-r-2xl rounded-bl-2xl' : 'bg-white text-gray-800 rounded-2xl rounded-bl-sm border border-gray-100'}`}>
                                   {msg.isHighlightCard ? (
                                     <div className="bg-white rounded-xl overflow-hidden border border-orange-200 shadow-md w-64">
                                        <div className="h-32 bg-orange-100 relative group cursor-pointer" onClick={() => handleJumpToVideo(msg.videoTime)}>
                                           <div className="absolute inset-0 flex items-center justify-center"><div className="bg-white/30 backdrop-blur-md p-3 rounded-full shadow-lg"><Play className="text-orange-600 fill-current ml-1" size={24}/></div></div>
                                           <div className="absolute bottom-2 left-2 right-2 flex justify-between items-center text-[10px] text-orange-800 font-medium"><span className="bg-white/80 px-2 py-0.5 rounded-full backdrop-blur-sm">âš ï¸ å¼‚å¸¸è¡Œä¸ºæ£€æµ‹</span><span>23:09</span></div>
                                        </div>
                                        <div className="p-3"><h4 className="font-bold text-gray-800 text-sm mb-1">{msg.title}</h4><p className="text-xs text-gray-600 leading-relaxed">{msg.text}</p></div>
                                     </div>
                                   ) : (
                                     <>{msg.title && <div className="font-bold mb-1">{msg.title}</div>}<div className="leading-relaxed whitespace-pre-wrap">{formatText(msg.text)}</div><div className={`text-[10px] mt-1 text-right ${msg.type === 'user' ? 'text-indigo-200' : 'text-gray-400'}`}>{msg.time}</div></>
                                   )}
                                </div>
                             </div>
                          </div>
                        ))}
                        {isAiThinking && <div className="flex justify-start items-center ml-10 animate-pulse"><div className="bg-white border border-gray-100 rounded-full px-4 py-2 flex items-center gap-2 shadow-sm"><Loader2 size={14} className="animate-spin text-indigo-500"/><span className="text-xs text-gray-500 font-medium">PetGuard æ­£åœ¨åˆ†æ...</span></div></div>}
                     </div>
                     <div className="p-3 bg-white border-t border-gray-100 shadow-lg z-30">
                        <div className="flex gap-2 overflow-x-auto pb-3 mb-1 scrollbar-hide"><button onClick={() => handleSendMessage('æ€»ç»“ä¸€ä¸‹æ —å­ä»Šå¤©çš„è¡¨ç°')} className="flex-shrink-0 px-3 py-1.5 bg-gray-50 border border-gray-200 rounded-full text-xs text-gray-600 hover:bg-orange-50 hover:text-orange-600 hover:border-orange-200 transition-all font-medium shadow-sm">ğŸ± æ€»ç»“æ —å­è¡¨ç°</button><button onClick={() => handleSendMessage('å¥¶æ²¹ä»Šå¤©è¿åŠ¨é‡å¤§å—ï¼Ÿ')} className="flex-shrink-0 px-3 py-1.5 bg-gray-50 border border-gray-200 rounded-full text-xs text-gray-600 hover:bg-orange-50 hover:text-orange-600 hover:border-orange-200 transition-all font-medium shadow-sm">ğŸ¦ å¥¶æ²¹è¿åŠ¨é‡</button><button onClick={() => handleSendMessage('ä»Šå¤©æœ‰æ²¡æœ‰å¼‚å¸¸æƒ…å†µï¼Ÿ')} className="flex-shrink-0 px-3 py-1.5 bg-gray-50 border border-gray-200 rounded-full text-xs text-gray-600 hover:bg-orange-50 hover:text-orange-600 hover:border-orange-200 transition-all font-medium shadow-sm">âš ï¸ æŸ¥å¼‚å¸¸</button></div>
                        <div className="flex gap-2 items-center"><input type="text" value={inputMessage} onChange={(e) => setInputMessage(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()} placeholder="å’Œçˆ±å® ç®¡å®¶èŠèŠå§..." className="flex-1 bg-gray-100 rounded-full px-5 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:bg-white transition-all text-gray-700 placeholder-gray-400"/><button onClick={() => handleSendMessage()} className={`bg-orange-500 text-white p-2.5 rounded-full hover:bg-orange-600 transition-all shadow-md active:scale-95 ${isAiThinking ? 'opacity-50 cursor-not-allowed' : ''}`} disabled={isAiThinking}><Send size={18} /></button></div>
                     </div>
                  </div>
              </div>

              {/* Tab 2: æ—¥æŠ¥ (Timeline) */}
              {activeTab === 'timeline' && (
                <div className="p-4 flex-1 overflow-y-auto bg-gray-50">
                  <div className="flex items-center justify-between mb-6 pt-2"><h2 className="text-xl font-bold text-gray-800">æ¯æ—¥å–µè®°</h2><div className="flex bg-white rounded-lg p-1 shadow-sm border border-gray-100">{['all', 'æ —å­', 'å¥¶æ²¹'].map(filter => <button key={filter} onClick={() => setSelectedCatFilter(filter)} className={`px-3 py-1 text-xs rounded-md transition-all ${selectedCatFilter === filter ? 'bg-orange-100 text-orange-700 font-bold' : 'text-gray-500 hover:text-gray-700'}`}>{filter === 'all' ? 'å…¨éƒ¨' : filter}</button>)}</div></div>
                  <div className="mb-8 space-y-4">
                     {(selectedCatFilter === 'all' || selectedCatFilter === 'æ —å­') && <div className="bg-white p-5 rounded-2xl border border-orange-100 shadow-sm relative overflow-hidden group hover:shadow-md transition-shadow"><div className="absolute top-0 right-0 p-3 opacity-10"><Sparkles className="text-orange-500" size={50}/></div><div className="flex items-center gap-2 mb-2"><div className="w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-600">æ —</div><span className="font-bold text-gray-800">æ —å­</span></div><div className="text-sm text-gray-600 leading-relaxed whitespace-pre-line pl-1">{formatText(catStats['æ —å­'].report)}</div></div>}
                     {(selectedCatFilter === 'all' || selectedCatFilter === 'å¥¶æ²¹') && <div className="bg-white p-5 rounded-2xl border border-yellow-100 shadow-sm relative overflow-hidden group hover:shadow-md transition-shadow"><div className="absolute top-0 right-0 p-3 opacity-10"><Moon className="text-yellow-500" size={50}/></div><div className="flex items-center gap-2 mb-2"><div className="w-6 h-6 rounded-full bg-yellow-100 flex items-center justify-center text-xs font-bold text-yellow-700">å¥¶</div><span className="font-bold text-gray-800">å¥¶æ²¹</span></div><div className="text-sm text-gray-600 leading-relaxed whitespace-pre-line pl-1">{formatText(catStats['å¥¶æ²¹'].report)}</div></div>}
                  </div>
                  <h3 className="text-sm font-bold text-gray-400 mb-4 uppercase tracking-wider">ä»Šæ—¥æ—¶é—´è½´</h3>
                  <div className="space-y-6 relative before:absolute before:left-[15px] before:top-2 before:bottom-0 before:w-0.5 before:bg-gray-200">
                     {logs.filter(log => selectedCatFilter === 'all' || log.cat.includes(selectedCatFilter) || (log.cat === 'åŒçŒ«' && selectedCatFilter !== 'all')).map(log => (
                       <div key={log.id} className="relative pl-8 group">
                         <div className={`absolute left-0 top-3 w-8 h-8 rounded-full border-4 border-gray-50 shadow-sm flex items-center justify-center z-10 transition-colors ${log.type === 'warning' ? 'bg-orange-500 text-white' : 'bg-white text-gray-400 group-hover:border-orange-100 group-hover:text-orange-400'}`}>{log.type === 'warning' ? <AlertTriangle size={14}/> : <Clock size={14}/>}</div>
                         <div className="bg-white rounded-xl p-3 shadow-sm border border-gray-100 flex gap-4 hover:shadow-md transition-all">
                            <div className={`w-24 h-16 rounded-lg flex-shrink-0 relative overflow-hidden group/img cursor-pointer ${log.thumbColor}`} onClick={() => { if (log.videoTime) { if (!videoUrl) return alert('è¯·å…ˆåœ¨ç›‘æ§é¡µä¸Šä¼ è§†é¢‘'); setPlayModal({ show: true, startTime: log.videoTime }); } }}><div className="absolute inset-0 flex items-center justify-center text-gray-400 opacity-50">{log.videoTime ? <Film size={20}/> : <VolumeX size={20}/>}</div>{log.videoTime && <div className="absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover/img:opacity-100 transition-opacity"><ZoomIn size={20} className="text-white drop-shadow-md"/></div>}</div>
                            <div className="flex-1 py-0.5"><div className="flex justify-between items-start mb-1"><span className="font-bold text-sm text-gray-800">{log.action}</span><span className="text-xs text-gray-400 font-mono">{log.time}</span></div><p className="text-xs text-gray-500 line-clamp-2 leading-relaxed mb-2">{log.detail}</p><div className="flex gap-2"><span className="text-[10px] bg-gray-50 border border-gray-100 px-2 py-0.5 rounded text-gray-500">{log.cat}</span>{log.videoTime && <span className="text-[10px] bg-blue-50 text-blue-600 px-2 py-0.5 rounded flex items-center gap-1 font-medium cursor-pointer" onClick={() => handleJumpToVideo(log.videoTime)}><PlayCircle size={10}/> æŸ¥çœ‹å›æ”¾</span>}</div></div>
                         </div>
                       </div>
                     ))}
                  </div>
                </div>
              )}

              {/* Tab 3: è®°å½• (Record) */}
              {activeTab === 'record' && (
                <div className="flex-1 bg-gray-50 overflow-y-auto flex flex-col">
                   <div className="bg-white px-4 pt-6 pb-4 border-b border-gray-100 sticky top-0 z-20">
                      <div className="flex justify-between items-center mb-4"><h2 className="text-2xl font-bold text-gray-900">å†å²è®°å½•</h2><button onClick={() => setShowCalendarModal(true)} className="text-gray-500 hover:text-gray-700 bg-gray-100 p-2 rounded-full hover:bg-gray-200 transition-colors"><Calendar size={20}/></button></div>
                      <div className="flex gap-2 overflow-x-auto scrollbar-hide pb-3">{weeklyStats.map(stat => <button key={stat.date} onClick={() => setSelectedDate(stat.date)} className={`flex-shrink-0 flex flex-col items-center justify-center w-12 h-14 rounded-xl border transition-all ${selectedDate === stat.date ? 'bg-orange-500 border-orange-500 text-white shadow-md' : 'bg-white border-gray-100 text-gray-400 hover:border-gray-300'}`}><span className="text-[10px] opacity-80">{stat.day}</span><span className="text-sm font-bold">{stat.date.split('/')[1]}</span></button>)}</div>
                      <div className="flex justify-center mt-2"><div className="flex bg-gray-100 rounded-lg p-0.5 shadow-inner">{['all', 'æ —å­', 'å¥¶æ²¹'].map(filter => <button key={filter} onClick={() => setRecordCatFilter(filter)} className={`px-4 py-1.5 text-xs rounded-md transition-all font-medium ${recordCatFilter === filter ? 'bg-white text-orange-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}>{filter === 'all' ? 'å…¨éƒ¨' : filter}</button>)}</div></div>
                   </div>
                   <div className="p-4 space-y-6">
                      <section className="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
                         <div className="flex justify-between items-center mb-4"><h3 className="text-sm font-bold text-gray-800 flex items-center gap-2"><BarChart2 size={16} className="text-orange-500"/> å¥åº·è¶‹åŠ¿ (7å¤©)</h3><div className="flex gap-3 text-[10px] text-gray-500 bg-gray-50 px-2 py-1 rounded"><span className={`flex items-center gap-1 font-medium transition-opacity ${(recordCatFilter === 'all' || recordCatFilter === 'æ —å­') ? 'opacity-100' : 'opacity-30'}`}><div className="w-2 h-2 rounded-full bg-[#fb923c]"></div> æ —å­(æ©™)</span><span className={`flex items-center gap-1 font-medium transition-opacity ${(recordCatFilter === 'all' || recordCatFilter === 'å¥¶æ²¹') ? 'opacity-100' : 'opacity-30'}`}><div className="w-2 h-2 rounded-full bg-[#facc15]"></div> å¥¶æ²¹(é»„)</span><span className="flex items-center gap-1 text-gray-400 pl-1 border-l border-gray-200">çº¿:æ´»è·ƒ æŸ±:è¿›é£Ÿ</span></div></div>
                         <div className="w-full h-40 relative overflow-x-auto scrollbar-hide">
                            <div className="min-w-[400px] h-full relative">
                                <div className="absolute inset-0 flex items-end justify-around px-4 pb-6">{weeklyStats.map((stat, i) => <div key={i} className="flex gap-1 items-end h-full w-4">{(recordCatFilter === 'all' || recordCatFilter === 'æ —å­') && <div className="w-1.5 bg-orange-100 rounded-t-sm relative group" style={{ height: `${stat.liziEat * 10}%` }}></div>}{(recordCatFilter === 'all' || recordCatFilter === 'å¥¶æ²¹') && <div className="w-1.5 bg-yellow-100 rounded-t-sm relative group" style={{ height: `${stat.creamEat * 10}%` }}></div>}</div>)}</div>
                                <svg className="absolute inset-0 w-full h-full pointer-events-none" style={{ paddingBottom: '24px' }}>{(recordCatFilter === 'all' || recordCatFilter === 'æ —å­') && <><polyline fill="none" stroke="#fb923c" strokeWidth="2" points={weeklyStats.map((s, i) => `${(i * (400/7)) + 28},${100 - s.liziActive}`).join(' ')} />{weeklyStats.map((s, i) => <circle key={i} cx={(i * (400/7)) + 28} cy={100 - s.liziActive} r="3" fill="white" stroke="#fb923c" strokeWidth="2" />)}</>}{(recordCatFilter === 'all' || recordCatFilter === 'å¥¶æ²¹') && <><polyline fill="none" stroke="#facc15" strokeWidth="2" points={weeklyStats.map((s, i) => `${(i * (400/7)) + 28},${100 - s.creamActive}`).join(' ')} />{weeklyStats.map((s, i) => <circle key={i} cx={(i * (400/7)) + 28} cy={100 - s.creamActive} r="3" fill="white" stroke="#facc15" strokeWidth="2" />)}</>}</svg>
                                <div className="absolute bottom-0 left-0 right-0 flex justify-around text-[10px] text-gray-400 px-2">{weeklyStats.map(s => <span key={s.date}>{s.date}</span>)}</div>
                            </div>
                         </div>
                      </section>
                      <section>
                         <h3 className="text-sm font-bold text-gray-800 mb-4 px-1 flex items-center justify-between"><span>{selectedDate === '11/24' ? 'ä»Šæ—¥' : selectedDate} å…³é”®äº‹ä»¶</span><span className="text-xs text-gray-400 font-normal">{recordLogs.filter(log => recordCatFilter === 'all' || log.cat.includes(recordCatFilter) || (log.cat === 'åŒçŒ«' && recordCatFilter !== 'all')).length} æ¡è®°å½•</span></h3>
                         {recordLogs.length > 0 ? (
                           <div className="space-y-6 relative before:absolute before:left-[15px] before:top-2 before:bottom-0 before:w-0.5 before:bg-gray-200">
                              {recordLogs.filter(log => recordCatFilter === 'all' || log.cat.includes(recordCatFilter) || (log.cat === 'åŒçŒ«' && recordCatFilter !== 'all')).map(log => (
                                <div key={log.id} className="relative pl-8 group">
                                   <div className={`absolute left-0 top-3 w-8 h-8 rounded-full border-4 border-gray-50 shadow-sm flex items-center justify-center z-10 transition-colors ${log.type === 'danger' ? 'bg-red-500 text-white' : 'bg-white text-gray-400 group-hover:border-orange-100 group-hover:text-orange-400'}`}>{log.type === 'danger' ? <AlertTriangle size={14}/> : <Clock size={14}/>}</div>
                                   <div className="relative rounded-2xl overflow-hidden shadow-sm group border border-gray-100 bg-white">
                                      <div className={`w-full h-40 ${log.thumbColor} relative cursor-pointer`} onClick={() => { if (log.videoTime) { if (!videoUrl) return alert('è¯·å…ˆåœ¨ç›‘æ§é¡µä¸Šä¼ è§†é¢‘'); setPlayModal({ show: true, startTime: log.videoTime }); } }}>
                                         <div className="absolute top-2 right-2 bg-black/50 text-white text-[10px] px-2 py-1 rounded backdrop-blur-sm flex items-center gap-1"><Clock size={10}/> {log.time}</div>
                                         <div className="absolute inset-0 flex items-center justify-center"><div className={`bg-white/20 backdrop-blur-sm p-3 rounded-full transition-transform ${log.videoTime ? 'group-hover:scale-110' : 'opacity-50'}`}>{log.videoTime ? <Play className="text-white fill-current" size={24}/> : <VolumeX className="text-white" size={24}/>}</div></div>
                                         <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-3 pt-8"><div className="text-white font-bold text-sm">{log.action}</div><div className="text-white/80 text-xs line-clamp-1">{log.detail}</div></div>
                                      </div>
                                      <div className="bg-white p-2 flex gap-2 rounded-b-2xl border-t border-gray-50"><span className={`text-[10px] px-2 py-0.5 rounded flex items-center gap-1 ${log.type === 'danger' ? 'bg-red-50 text-red-600' : 'bg-indigo-50 text-indigo-600'}`}>{log.type === 'danger' ? <AlertTriangle size={10}/> : <Sparkles size={10}/>} {log.type === 'danger' ? 'å¼‚å¸¸æ£€æµ‹' : 'AI è¯†åˆ«'}</span><span className="text-[10px] bg-gray-50 text-gray-500 px-2 py-0.5 rounded border border-gray-100">{log.cat}</span></div>
                                   </div>
                                </div>
                              ))}
                           </div>
                         ) : <div className="flex flex-col items-center justify-center py-10 text-gray-400 space-y-2"><div className="bg-gray-100 p-4 rounded-full"><Film size={24} className="opacity-50"/></div><p className="text-xs">è¯¥æ—¥æœŸæ— å…³é”®å½•åƒ</p></div>}
                      </section>
                   </div>
                </div>
              )}

              {/* Tab 4: è®¾ç½® (Settings) */}
              {activeTab === 'settings' && (
                <div className="flex-1 bg-gray-50 overflow-y-auto">
                   <div className="bg-white px-6 py-8 border-b border-gray-100"><h2 className="text-2xl font-bold text-gray-900 mb-1">è®¾ç½®</h2><p className="text-sm text-gray-500">ç®¡ç†æ‚¨çš„è®¾å¤‡ä¸å® ç‰©æ¡£æ¡ˆ</p></div>
                   <div className="p-4 space-y-6">
                      <section>
                         <div className="flex justify-between items-center mb-3 px-1"><h3 className="text-sm font-bold text-gray-700 uppercase tracking-wide">æˆ‘çš„å® ç‰©</h3><button className="text-xs text-orange-600 font-medium hover:text-orange-700">æ·»åŠ å® ç‰©</button></div>
                         <div className="space-y-3">{Object.keys(catStats).map(cat => <div key={cat} className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between group cursor-pointer hover:border-orange-200 transition-colors"><div className="flex items-center gap-4"><div className={`w-12 h-12 rounded-full ${catStats[cat].avatarColor} flex items-center justify-center text-lg font-bold text-gray-600 shadow-inner`}>{cat[0]}</div><div><div className="font-bold text-gray-900">{cat}</div><div className="text-xs text-gray-500 mt-0.5">{catStats[cat].type} Â· {catStats[cat].weight}</div></div></div><div className="bg-gray-50 p-2 rounded-full text-gray-400 group-hover:bg-orange-50 group-hover:text-orange-500 transition-colors"><Edit2 size={16}/></div></div>)}</div>
                      </section>
                      <section>
                         <h3 className="text-sm font-bold text-gray-700 uppercase tracking-wide mb-3 px-1">è®¾å¤‡çŠ¶æ€</h3>
                         <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"><div className="p-4 flex items-center justify-between border-b border-gray-50"><div className="flex items-center gap-3"><div className="bg-blue-50 p-2 rounded-lg text-blue-600"><Camera size={20}/></div><div><div className="text-sm font-bold text-gray-900">PetGuard Pro</div><div className="text-xs text-gray-500">å›ºä»¶ v2.4.1 (æœ€æ–°)</div></div></div><div className="flex items-center gap-1 text-green-500 bg-green-50 px-2 py-1 rounded text-xs font-medium"><div className="w-1.5 h-1.5 rounded-full bg-green-500"></div> åœ¨çº¿</div></div><div className="grid grid-cols-2 divide-x divide-gray-50"><div className="p-3 flex items-center justify-center gap-2 text-sm text-gray-600"><Wifi size={16} className="text-gray-400"/> ä¿¡å·å¼º</div><div className="p-3 flex items-center justify-center gap-2 text-sm text-gray-600"><Battery size={16} className="text-gray-400"/> æ¥é€šç”µæº</div></div></div>
                      </section>
                      <section>
                         <h3 className="text-sm font-bold text-gray-700 uppercase tracking-wide mb-3 px-1">é€šç”¨</h3>
                         <div className="bg-white rounded-xl shadow-sm border border-gray-100 divide-y divide-gray-50"><div className="p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50"><div className="flex items-center gap-3"><div className="bg-orange-50 p-2 rounded-lg text-orange-600"><Bell size={18}/></div><span className="text-sm font-medium text-gray-700">æ™ºèƒ½é€šçŸ¥æ¨é€</span></div><div className="w-10 h-6 bg-orange-500 rounded-full relative"><div className="absolute top-1 right-1 w-4 h-4 bg-white rounded-full shadow-sm"></div></div></div><div className="p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50"><div className="flex items-center gap-3"><div className="bg-purple-50 p-2 rounded-lg text-purple-600"><Shield size={18}/></div><span className="text-sm font-medium text-gray-700">éšç§ä¿æŠ¤æ¨¡å¼</span></div><ChevronRight size={16} className="text-gray-400"/></div></div>
                      </section>
                      <div className="text-center text-xs text-gray-400 py-4">PetGuard App v1.0.0 (Beta)</div>
                   </div>
                </div>
              )}

              <div className="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-xl border-t border-gray-200 flex justify-around items-center px-6 pb-safe pt-1 max-w-md mx-auto z-40 h-[65px] shadow-[0_-1px_10px_rgba(0,0,0,0.02)]">
                <TabButton id="home" icon={Camera} label="é¦–é¡µ" />
                <TabButton id="timeline" icon={Activity} label="æ—¥æŠ¥" />
                <TabButton id="record" icon={Calendar} label="è®°å½•" />
                <TabButton id="settings" icon={Settings} label="è®¾ç½®" />
              </div>
            </div>
          );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
